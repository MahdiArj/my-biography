<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TLW98ZDJZY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TLW98ZDJZY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biography Profile</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fonts: Viaoda Libre (Title) and Poppins (Text) -->
    <link href="https://fonts.googleapis.com/css2?family=Viaoda+Libre&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        /* Custom Font Assignments */
        .font-serif { font-family: 'Viaoda Libre', serif; }
        .font-sans { font-family: 'Poppins', sans-serif; }

        /* Arc-shaped mask for the photo */
        .image-fade-mask {
            mask-image: radial-gradient(ellipse 130% 100% at 50% 0%, black 55%, transparent 100%);
            -webkit-mask-image: radial-gradient(ellipse 130% 100% at 50% 0%, black 55%, transparent 100%);
        }

        /* Hide scrollbar for chat */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Custom color variables */
        :root {
            --bg-gold: #B7AA7E; 
            --bg-dark: #2A2A35;
            --text-brown: #35231E; 
            --btn-bg: #EEF4F0; 
        }

        /* Typing indicator animation */
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-[#B7AA7E] min-h-screen flex justify-center items-start sm:items-center font-sans antialiased selection:bg-black/20">

    <!-- Mobile Container -->
    <div class="relative w-full max-w-md bg-[#B7AA7E] min-h-screen sm:min-h-[850px] sm:h-auto sm:rounded-[40px] shadow-2xl overflow-hidden flex flex-col transition-all duration-300" id="main-container">
        
        <!-- Top Status Bar -->
        <div class="absolute top-0 w-full p-6 flex justify-end items-center z-20 text-white/80">
            <!-- Share Button -->
            <button onclick="shareProfile()" class="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/30 transition" title="Share Website">
                <i data-lucide="share" class="w-5 h-5 text-white"></i>
            </button>
        </div>

        <!-- BACKGROUND & PHOTO SECTION -->
        <div class="relative w-full h-[55vh] sm:h-[450px]">
            <!-- Background Gradient -->
            <div class="absolute inset-0 bg-gradient-to-b from-[#2A2A35] to-[#B7AA7E]"></div>
            
            <!-- User Photo with Arc Mask -->
            <img 
                src="IMG_2148.jpg" 
                onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=1000&auto=format&fit=crop';"
                alt="Profile Photo" 
                class="absolute inset-0 w-full h-full object-cover object-top image-fade-mask opacity-90"
            >
            
            <!-- Scroll Overlay -->
            <div id="scroll-overlay" class="absolute inset-0 bg-gradient-to-t from-[#B7AA7E] via-[#B7AA7E] to-transparent opacity-0 pointer-events-none transition-opacity duration-100 ease-out z-10"></div>
            
            <!-- Static Bottom Blend -->
            <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-[#B7AA7E] via-[#B7AA7E]/60 to-transparent z-0"></div>
        </div>

        <!-- CONTENT SECTION -->
        <div class="relative z-10 px-8 pb-8 flex flex-col items-center -mt-10 flex-grow">
            
            <!-- Title -->
            <h1 class="font-serif text-4xl sm:text-5xl text-[#35231E] mb-3 tracking-wide text-center">Biography</h1>
            
            <!-- Bio Text with Magic Remix Button -->
            <div class="relative group w-full flex justify-center mb-10">
                <p id="bio-text" class="text-center text-[#35231E] text-sm sm:text-base leading-relaxed font-medium max-w-xs transition-all duration-500">
                    Ph.D. Candidate and Recitation Instructor at Civil & Environmental Engineering Department of Louisiana State University
                </p>
                <!-- Magic Wand Button -->
                <button onclick="toggleRemixMenu()" class="absolute -right-2 top-0 p-2 text-[#35231E]/40 hover:text-[#35231E] transition-colors" title="Remix Bio with AI">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                </button>
                
                <!-- Remix Dropdown -->
                <div id="remix-menu" class="hidden absolute top-8 right-0 bg-white/90 backdrop-blur-md rounded-xl shadow-lg p-2 z-30 w-40 border border-white/20">
                    <div class="text-xs font-semibold text-gray-500 mb-2 px-2">✨ Rewrite Bio</div>
                    <button onclick="remixBio('Professional')" class="w-full text-left px-2 py-1.5 text-sm text-gray-700 hover:bg-black/5 rounded-lg transition-colors">Professional</button>
                    <button onclick="remixBio('Simple')" class="w-full text-left px-2 py-1.5 text-sm text-gray-700 hover:bg-black/5 rounded-lg transition-colors">Explain like I'm 5</button>
                    <button onclick="remixBio('Witty')" class="w-full text-left px-2 py-1.5 text-sm text-gray-700 hover:bg-black/5 rounded-lg transition-colors">Witty</button>
                </div>
            </div>

            <!-- Action Buttons Stack -->
            <div class="w-full flex flex-col gap-4 mb-8">
                
                <!-- AI Chat Button -->
                <button onclick="openChat()" class="group relative overflow-hidden bg-gradient-to-r from-indigo-900 to-[#2A2A35] hover:to-indigo-800 text-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-lg border border-white/10">
                    <!-- Animated Shine Effect -->
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"></div>
                    
                    <div class="text-white/90">
                        <i data-lucide="message-circle-code" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center font-semibold text-sm tracking-wide">✨ Chat with my AI</span>
                    <div class="text-white/50">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </div>
                </button>

                <!-- Email Button -->
                <a href="mailto:marjma1@lsu.edu" class="group bg-[#EEF4F0] hover:bg-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-sm">
                    <div class="text-[#35231E]">
                        <i data-lucide="mail" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center text-[#35231E] font-semibold text-sm">Email</span>
                    <div class="text-[#35231E]/60">
                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                    </div>
                </a>

                <!-- Google Scholar -->
                <a href="https://scholar.google.com/citations?user=bsUu7D0AAAAJ&hl=en" class="group bg-[#EEF4F0] hover:bg-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-sm">
                    <div class="text-[#35231E]">
                        <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center text-[#35231E] font-semibold text-sm">Google Scholar</span>
                    <div class="text-[#35231E]/60">
                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                    </div>
                </a>

                <!-- LinkedIn -->
                <a href="https://www.linkedin.com/authwall?trk=bf&trkInfo=AQF0XtTcGhQ84gAAAZwvpoholO_5pikdoH8ojfVlk3QMObDYKK_dIJTV_Bu-EaZ2rEfHj0ZEKmwfJRBrV4HRDua9nip1lsIjZ8iJn2bqkZ-9Jv_FsUyi1xOJ21QnopeEG709kKs=&original_referer=&sessionRedirect=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fmahdi-arjmandazar-390aa495" class="group bg-[#EEF4F0] hover:bg-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-sm">
                    <div class="text-[#35231E]">
                        <i data-lucide="linkedin" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center text-[#35231E] font-semibold text-sm">LinkedIn</span>
                    <div class="text-[#35231E]/60">
                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                    </div>
                </a>

                <!-- GitHub -->
                <a href="https://github.com/MahdiArj" class="group bg-[#EEF4F0] hover:bg-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-sm">
                    <div class="text-[#35231E]">
                        <i data-lucide="github" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center text-[#35231E] font-semibold text-sm">GitHub</span>
                    <div class="text-[#35231E]/60">
                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                    </div>
                </a>

                <!-- X (Twitter) -->
                <a href="https://mobile.twitter.com/Mahdi_Arjomand_" class="group bg-[#EEF4F0] hover:bg-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-sm">
                    <div class="text-[#35231E]">
                        <i data-lucide="twitter" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center text-[#35231E] font-semibold text-sm">X</span>
                    <div class="text-[#35231E]/60">
                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                    </div>
                </a>

                <!-- Instagram -->
                <a href="https://instagram.com/mahdi.arjomandazar?utm_medium=copy_link" class="group bg-[#EEF4F0] hover:bg-white active:scale-[0.98] transition-all duration-200 h-14 rounded-full flex items-center px-6 shadow-sm">
                    <div class="text-[#35231E]">
                        <i data-lucide="instagram" class="w-6 h-6"></i>
                    </div>
                    <span class="flex-grow text-center text-[#35231E] font-semibold text-sm">Instagram</span>
                    <div class="text-[#35231E]/60">
                        <i data-lucide="more-vertical" class="w-4 h-4"></i>
                    </div>
                </a>
            </div>

            <!-- COPYRIGHT FOOTER -->
            <div class="mt-auto pt-4 pb-2 text-center text-[#35231E]/70 text-[10px] sm:text-xs font-sans tracking-wide">
                <p>&copy; All rights are reserved to the Mahdi A. Varjovi</p>
            </div>
        </div>
    </div>

    <!-- AI CHAT MODAL OVERLAY -->
    <div id="chat-modal" class="fixed inset-0 z-50 hidden flex-col bg-black/40 backdrop-blur-sm sm:items-center sm:justify-center p-4">
        <!-- Chat Container -->
        <div class="bg-white w-full max-w-md h-full sm:h-[600px] rounded-3xl shadow-2xl flex flex-col overflow-hidden animate-[slideUp_0.3s_ease-out]">
            
            <!-- Header -->
            <div class="bg-[#2A2A35] p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center">
                        <i data-lucide="sparkles" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-serif text-lg leading-tight">Digital Assistant</h3>
                        <p class="text-xs text-white/60">Powered by Gemini</p>
                    </div>
                </div>
                <button onclick="closeChat()" class="p-2 hover:bg-white/10 rounded-full transition">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Messages Area -->
            <div id="chat-messages" class="flex-1 bg-gray-50 p-4 overflow-y-auto no-scrollbar flex flex-col gap-4">
                <!-- Welcome Message -->
                <div class="flex items-start gap-2 max-w-[85%]">
                    <div class="w-8 h-8 rounded-full bg-[#2A2A35] flex-shrink-0 flex items-center justify-center text-white text-xs">AI</div>
                    <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-gray-700 border border-gray-100">
                        Hello! I'm the digital assistant for this profile. Ask me about the research, background, or how to get in touch!
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 bg-white border-t border-gray-100">
                <form id="chat-form" onsubmit="handleChatSubmit(event)" class="relative flex items-center gap-2">
                    <input 
                        type="text" 
                        id="user-input" 
                        class="w-full bg-gray-100 text-gray-800 rounded-full py-3 px-5 pr-12 text-sm focus:outline-none focus:ring-2 focus:ring-[#2A2A35]/20 transition-all placeholder:text-gray-400"
                        placeholder="Ask a question..."
                        autocomplete="off"
                    >
                    <button type="submit" class="absolute right-2 p-2 bg-[#2A2A35] hover:bg-black text-white rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="send-btn">
                        <i data-lucide="send-horizontal" class="w-4 h-4"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const apiKey = "AIzaSyDH_45muNueTXW6j7u4u8IecSq3Ts680zs"; // Updated with user provided key
        let aiConfig = null; // Will hold the data from JSON
        
        // --- LUCIDE ICONS ---
        lucide.createIcons();

        // --- FETCH CONFIGURATION ---
        // This function loads your personal data from ai-data.json when the page loads
        async function loadAIConfig() {
            try {
                const response = await fetch('ai-data.json');
                if (!response.ok) throw new Error('Failed to load AI config');
                aiConfig = await response.json();
                console.log("AI Config loaded successfully");
            } catch (error) {
                console.error("Could not load AI Config:", error);
                // Fallback default just in case
                aiConfig = {
                    persona: "You are a helpful assistant.",
                    user_context: {},
                    constraints: "Keep answers short."
                };
            }
        }
        
        // Load the config immediately
        loadAIConfig();

        // --- SCROLL EFFECT FOR VANISHING PHOTO ---
        window.addEventListener('scroll', () => {
            const scrollY = window.scrollY;
            const maxScroll = 300; 
            const overlayEl = document.getElementById('scroll-overlay');
            if (overlayEl) {
                const opacity = Math.min(1, scrollY / maxScroll);
                overlayEl.style.opacity = opacity;
            }
        });

        // --- UI LOGIC ---
        function shareProfile() {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: 'Mahdi A. Varjovi Biography',
                    text: 'Check out this biography profile.',
                    url: url
                }).catch(console.error);
            } else {
                const dummy = document.createElement('input');
                document.body.appendChild(dummy);
                dummy.value = url;
                dummy.select();
                document.execCommand('copy');
                document.body.removeChild(dummy);
                alert('Website address copied to clipboard!');
            }
        }

        function toggleRemixMenu() {
            document.getElementById('remix-menu').classList.toggle('hidden');
        }

        function openChat() {
            document.getElementById('chat-modal').classList.remove('hidden');
            document.getElementById('chat-modal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeChat() {
            document.getElementById('chat-modal').classList.add('hidden');
            document.getElementById('chat-modal').classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        // --- GEMINI API HELPERS ---
        async function callGemini(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            const maxRetries = 3;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (e) {
                    if (i === maxRetries - 1) throw e;
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, i))); 
                }
            }
        }

        // --- FEATURE 1: BIO REMIXER ---
        async function remixBio(style) {
            const bioTextEl = document.getElementById('bio-text');
            // We read the original bio from the DOM or config
            const originalText = "Ph.D. Candidate and Recitation Instructor at Civil & Environmental Engineering Department of Louisiana State University";
            
            bioTextEl.style.opacity = '0.5';
            document.getElementById('remix-menu').classList.add('hidden');
            
            const systemPrompt = "You are an expert copywriter. Rewrite the biography text to match the requested style. Keep it concise (under 25 words).";
            const userPrompt = `Style: ${style}. Text: "${originalText}"`;

            try {
                const newBio = await callGemini(userPrompt, systemPrompt);
                bioTextEl.innerText = newBio;
            } catch (error) {
                console.error("Remix failed:", error);
                bioTextEl.innerText = originalText;
                alert("Couldn't connect to AI. Please try again.");
            } finally {
                bioTextEl.style.opacity = '1';
            }
        }

        // --- FEATURE 2: CHATBOT ---
        async function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            input.value = '';
            appendMessage(message, 'user');
            const loadingId = appendLoading();

            // CONSTRUCT SYSTEM PROMPT DYNAMICALLY FROM JSON
            let systemPrompt = "You are a helpful assistant.";
            
            if (aiConfig) {
                systemPrompt = `
                    ${aiConfig.persona}
                    Tone: ${aiConfig.tone}
                    
                    User Context:
                    ${JSON.stringify(aiConfig.user_context, null, 2)}
                    
                    Research Interests:
                    ${aiConfig.research_interests.join(", ")}
                    
                    Instructions:
                    ${aiConfig.contact_instructions}
                    ${aiConfig.constraints}
                `;
            }

            try {
                const response = await callGemini(message, systemPrompt);
                removeMessage(loadingId);
                appendMessage(response, 'ai');
            } catch (error) {
                removeMessage(loadingId);
                appendMessage("I'm having trouble connecting to the network right now. Please try again later.", 'ai');
            }
        }

        function appendMessage(text, sender) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            if (sender === 'user') {
                div.className = "flex items-start gap-2 max-w-[85%] self-end flex-row-reverse";
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gray-200 flex-shrink-0 flex items-center justify-center text-gray-500 text-xs">You</div>
                    <div class="bg-[#2A2A35] text-white p-3 rounded-2xl rounded-tr-none shadow-sm text-sm">
                        ${text}
                    </div>
                `;
            } else {
                div.className = "flex items-start gap-2 max-w-[85%]";
                const parsedText = marked.parse(text);
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-[#2A2A35] flex-shrink-0 flex items-center justify-center text-white text-xs">AI</div>
                    <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-gray-700 border border-gray-100 prose prose-sm max-w-none">
                        ${parsedText}
                    </div>
                `;
            }
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function appendLoading() {
            const container = document.getElementById('chat-messages');
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex items-start gap-2 max-w-[85%]";
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-[#2A2A35] flex-shrink-0 flex items-center justify-center text-white text-xs">AI</div>
                <div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-100 flex gap-1">
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return id;
        }

        function removeMessage(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }
    </script>
</body>
</html>


